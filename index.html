<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a5f7a">
  <title>Vail Bus</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
      padding: 16px;
      padding-top: env(safe-area-inset-top, 16px);
    }
    h1 {
      font-size: 1.5rem;
      text-align: center;
      color: #38bdf8;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    .tab {
      flex: 1;
      padding: 12px 8px;
      border: none;
      border-radius: 8px;
      background: #1e293b;
      color: #94a3b8;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab.active {
      background: #1a5f7a;
      color: #fff;
    }
    .direction-toggle {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    .direction-btn {
      flex: 1;
      padding: 10px;
      border: 2px solid #1a5f7a;
      border-radius: 8px;
      background: transparent;
      color: #94a3b8;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .direction-btn.active {
      background: #1a5f7a;
      color: #fff;
    }
    .now {
      background: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
    }
    .now-label { color: #94a3b8; font-size: 0.85rem; }
    .now-time {
      font-size: 2.5rem;
      font-weight: 700;
      color: #4ade80;
      margin: 8px 0;
    }
    .now-until { color: #94a3b8; }
    .schedule {
      background: #1e293b;
      border-radius: 12px;
      padding: 12px;
    }
    .schedule h3 {
      color: #94a3b8;
      font-size: 0.8rem;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .times {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
    }
    .time {
      background: #334155;
      padding: 8px 2px;
      border-radius: 6px;
      text-align: center;
      font-size: 0.8rem;
    }
    .time.next {
      background: #4ade80;
      color: #0f172a;
      font-weight: 600;
    }
    .time.past {
      opacity: 0.4;
    }
  </style>
</head>
<body>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <div style="width:40px;"></div>
    <h1 style="margin:0;">üöå Vail Bus</h1>
    <button onclick="location.reload()" style="width:40px;height:40px;border:none;background:#1e293b;color:#94a3b8;border-radius:8px;font-size:1.2rem;cursor:pointer;">‚Üª</button>
  </div>

  <div class="tabs">
    <button class="tab active" data-stop="eaglevail">EagleVail Rd</button>
    <button class="tab" data-stop="avon">Avon Station</button>
    <button class="tab" data-stop="vail">Vail TC</button>
  </div>

  <div class="direction-toggle">
    <button class="direction-btn active" data-dir="west">‚Üê West (Beaver Creek)</button>
    <button class="direction-btn" data-dir="east">East (Vail) ‚Üí</button>
  </div>

  <div class="now">
    <div class="now-label">Next Bus <span id="dirLabel">to Beaver Creek</span></div>
    <div class="now-time" id="nextBus">--:--</div>
    <div class="now-until" id="untilNext"></div>
  </div>

  <div class="schedule">
    <h3>Today's Schedule</h3>
    <div class="times" id="times"></div>
  </div>

  <script>
    const schedules = {
      eaglevail: {
        west: ['5:38','6:23','6:43','7:03','7:23','7:43','8:03','8:23','8:43','9:03','9:23','9:43','10:03','10:23','10:43','11:03','11:23','11:43','12:03','12:23','12:43','13:03','13:23','13:43','14:03','14:23','14:43','15:03','15:23','15:33','15:43','16:03','16:23','16:33','16:43','17:03','17:23','17:33','17:43','18:03','18:23','18:53','19:23','19:53','20:23','20:53','21:23','21:53','22:23','22:53','23:23','23:53','0:23','0:53','1:23'],
        east: ['5:42','6:17','6:42','6:57','7:17','7:37','7:57','8:17','8:37','8:57','9:17','9:37','9:57','10:17','10:37','10:57','11:17','11:37','11:57','12:17','12:37','12:57','13:17','13:37','13:57','14:17','14:37','14:57','15:17','15:27','15:37','15:57','16:17','16:27','16:37','16:57','17:17','17:27','17:37','17:57','18:17','18:47','19:17','19:47','20:17','20:47','21:17','21:47','22:17','22:47','23:17','23:47','0:17','0:47','1:17']
      },
      avon: {
        west: ['5:46','6:28','6:48','7:08','7:28','7:48','8:08','8:28','8:48','9:08','9:28','9:48','10:08','10:28','10:48','11:08','11:28','11:48','12:08','12:28','12:48','13:08','13:28','13:48','14:08','14:28','14:48','15:08','15:28','15:38','15:48','16:08','16:28','16:38','16:48','17:08','17:28','17:38','17:48','18:08','18:28','18:58','19:28','19:58','20:28','20:58','21:28','21:58','22:28','22:58','23:28','23:58','0:28','0:58','1:28'],
        east: ['5:37','6:12','6:37','6:52','7:12','7:32','7:52','8:12','8:32','8:52','9:12','9:32','9:52','10:12','10:32','10:52','11:12','11:32','11:52','12:12','12:32','12:52','13:12','13:32','13:52','14:12','14:32','14:52','15:12','15:22','15:32','15:52','16:12','16:22','16:32','16:52','17:12','17:22','17:32','17:52','18:12','18:42','19:12','19:42','20:12','20:42','21:12','21:42','22:12','22:42','23:12','23:42','0:12','0:42','1:12']
      },
      vail: {
        west: ['5:25','6:05','6:25','6:45','7:05','7:25','7:45','8:05','8:25','8:45','9:05','9:25','9:45','10:05','10:25','10:45','11:05','11:25','11:45','12:05','12:25','12:45','13:05','13:25','13:45','14:05','14:25','14:45','15:05','15:15','15:20','15:25','15:45','16:05','16:15','16:20','16:25','16:45','17:05','17:15','17:20','17:25','17:45','18:05','18:35','19:05','19:35','20:05','20:35','21:05','21:35','22:05','22:35','23:05','23:35','0:05','0:35','1:05'],
        east: ['5:55','6:47','7:07','7:27','7:47','8:07','8:27','8:47','9:07','9:27','9:47','10:07','10:27','10:47','11:07','11:27','11:47','12:07','12:27','12:47','13:07','13:27','13:47','14:07','14:27','14:47','15:07','15:27','15:47','15:57','16:07','16:27','16:47','16:57','17:07','17:27','17:47','17:57','18:07','18:27','18:47','19:17','19:47','20:17','20:47','21:17','21:47','22:17','22:47','23:17','23:47','0:17','0:47','1:17','1:47']
      }
    };

    let currentStop = 'eaglevail';
    let currentDir = 'west';

    function toAmPm(t) {
      const [h, m] = t.split(':').map(Number);
      const suffix = h >= 12 && h < 24 ? 'p' : 'a';
      const hour = h % 12 || 12;
      return `${hour}:${m.toString().padStart(2, '0')}${suffix}`;
    }

    function getNowSecs() {
      const d = new Date();
      return d.getHours() * 3600 + d.getMinutes() * 60 + d.getSeconds();
    }

    function parseTimeSecs(t) {
      const [h, m] = t.split(':').map(Number);
      return h * 3600 + m * 60;
    }

    let nextBusSecs = null;

    function updateCountdown() {
      if (!nextBusSecs) return;
      const now = getNowSecs();
      let diff = nextBusSecs - (now < 18000 ? now + 86400 : now);
      if (diff < 0) diff = 0;
      const mins = Math.floor(diff / 60);
      const secs = diff % 60;
      if (mins >= 60) {
        const h = Math.floor(mins / 60);
        const m = mins % 60;
        document.getElementById('untilNext').textContent = `${h}h ${m}m ${secs}s`;
      } else if (mins > 0) {
        document.getElementById('untilNext').textContent = `${mins}m ${secs}s`;
      } else if (secs > 0) {
        document.getElementById('untilNext').textContent = `${secs}s`;
      } else {
        document.getElementById('untilNext').textContent = 'Now!';
      }
    }

    function render() {
      const times = schedules[currentStop][currentDir];
      const now = getNowSecs();
      const container = document.getElementById('times');

      let nextTime = null;
      let nextDiff = Infinity;

      container.innerHTML = times.map(t => {
        const secs = parseTimeSecs(t);
        let adjustedSecs = secs;
        if (secs < 18000) adjustedSecs += 86400;

        const diff = adjustedSecs - (now < 18000 ? now + 86400 : now);
        const isPast = diff < 0;
        const isNext = !isPast && diff < nextDiff;

        if (isNext) {
          nextDiff = diff;
          nextTime = t;
          nextBusSecs = adjustedSecs;
        }

        return `<div class="time ${isPast ? 'past' : ''} ${isNext ? 'next' : ''}">${toAmPm(t)}</div>`;
      }).join('');

      document.getElementById('nextBus').textContent = nextTime ? toAmPm(nextTime) : '--:--';
      document.getElementById('dirLabel').textContent = dirLabels[currentDir];
      if (!nextTime) {
        nextBusSecs = null;
        document.getElementById('untilNext').textContent = 'No more buses today';
      } else {
        updateCountdown();
      }
    }

    const defaultDir = { eaglevail: 'west', avon: 'east', vail: 'west' };
    const showToggle = { eaglevail: true, avon: false, vail: false };
    const dirLabels = { west: 'to Beaver Creek', east: 'to Vail' };

    function updateToggle() {
      const toggle = document.querySelector('.direction-toggle');
      toggle.style.display = showToggle[currentStop] ? 'flex' : 'none';
    }

    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentStop = btn.dataset.stop;
        currentDir = defaultDir[currentStop];
        document.querySelectorAll('.direction-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`.direction-btn[data-dir="${currentDir}"]`).classList.add('active');
        updateToggle();
        render();
      });
    });

    document.querySelectorAll('.direction-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.direction-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentDir = btn.dataset.dir;
        render();
      });
    });

    render();
    updateToggle();
    setInterval(render, 30000);
    setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
